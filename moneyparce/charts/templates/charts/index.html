{% extends 'base.html' %}
{% block content %}
{% load static %}
<div style="display:flex; align-items:center;justify-content:center">
<h1>Your Spending Dashboard</h1>
</div>

<form method="get" style="margin-bottom: 2em;display:flex; align-items:center;justify-content:center">
  <label>Category:</label>
  <input type="text" name="category" value="{{ selected_category }}">

  <label>Start Date:</label>
  <input type="date" name="start_date" value="{{ start_date }}">

  <label>End Date:</label>
  <input type="date" name="end_date" value="{{ end_date }}">

  <button type="submit">Filter</button>
</form>

<div style="display:flex; gap:2em; flex-wrap:wrap;">

  <!-- Reference Graph Panel -->
  <div style="flex:1 1 45%; border:1px solid #ccc; padding:1em;">
    <h2 style="display:flex; align-items:center;justify-content:center">
      Reference Graph
    </h2>
    <div style="display:flex; align-items:center;justify-content:center; gap:2em;">
      <button type="button" id="setRefBtn">Set to Current</button>
      <button type="button" id="clearRefBtn">Clear</button>
    </div>
    
    <div style="min-height:200px; display:flex; align-items:center; justify-content:center; background:#f9f9f9;">
      <img id="refGraph" src="" alt="No reference set" style="max-width:100%; display:none;">
      <span id="noRefMsg">No reference graph yet.</span>
    </div>
  </div>

  <!-- Current Graph Panel -->
  <div style="flex:1 1 45%; border:1px solid #ccc; padding:1em;">
    <h2 style="display:flex; align-items:center;justify-content:center" >Current Graph</h2>
    <div style="min-height:200px; display:flex; align-items:center; justify-content:center; background:#f9f9f9;">
      <img id="liveGraph" src="data:image/png;base64,{{ chart }}" alt="Spending Over Time" style="max-width:100%;">
    </div>
  </div>

</div>

<script>
  const live = document.getElementById('liveGraph');
  const ref  = document.getElementById('refGraph');
  const noRefMsg = document.getElementById('noRefMsg');
  const setBtn = document.getElementById('setRefBtn');
  const clrBtn = document.getElementById('clearRefBtn');

  // Load saved reference on page load
  document.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem('refGraphSrc');
    if (saved) {
      ref.src = saved;
      ref.style.display = 'block';
      noRefMsg.style.display = 'none';
    }
  });

  // “Set to Current”
  setBtn.addEventListener('click', () => {
    const src = live.src;
    localStorage.setItem('refGraphSrc', src);
    ref.src = src;
    ref.style.display = 'block';
    noRefMsg.style.display = 'none';
  });

  // “Clear Reference”
  clrBtn.addEventListener('click', () => {
    localStorage.removeItem('refGraphSrc');
    ref.src = '';
    ref.style.display = 'none';
    noRefMsg.style.display = 'block';
  });
</script>
{% endblock content %}
